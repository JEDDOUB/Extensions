{
  "$schema": "https://cityjson.org/schemas/cityjson-extension/1.0.0/CityJSONExtension.schema.json",
  "type": "CityJSONExtension",
  "name": "Dynamizer",
  "url": "https://raw.githubusercontent.com/JEDDOUB/Extensions/refs/heads/main/dynamizer-v2-structure.ext%20(1).json",
  "version": "2.0",
  "versionCityJSON": "2.0",
  "description": "Attach dynamic time-series sensor data to CityJSON features (simple observations model).",
  "definitions": {
    "TM_Position": {
      "oneOf": [
        { "type": "string", "format": "date-time" },
        { "type": "string" }  // fallback if your values are ISO-like without 'Z'
      ]
    },
    "SensorConnection": {
      "type": "object",
      "properties": {
        "sensorId": { "type": "string" },
        "serviceType": { "type": "string", "enum": ["HTTP", "MQTT", "Other"] },
        "sourceURL": { "type": "string", "format": "uri" },
        "observationURL": { "type": "string", "format": "uri" },
        "position": {
          "type": "object",
          "properties": {
            "x": { "type": "number" },
            "y": { "type": "number" },
            "z": { "type": "number" }
          },
          "required": ["x","y","z"],
          "additionalProperties": false
        },
        "metadata": {
          "type": "object",
          "additionalProperties": true
        }
      },
      "required": ["sensorId"],
      "additionalProperties": false
    },
    "Observation": {
      "type": "object",
      "properties": {
        "time": { "$ref": "#/definitions/TM_Position" },
        "value": { "type": "number" },
        "uom": { "type": "string" }
      },
      "required": ["time", "value"],
      "additionalProperties": false
    },
    "ObservationsTimeseries": {
      "type": "object",
      "properties": {
        "observations": {
          "type": "array",
          "items": { "$ref": "#/definitions/Observation" },
          "minItems": 1
        }
      },
      "required": ["observations"],
      "additionalProperties": false
    },
    "DynamizerAttachment": {
      "type": "object",
      "properties": {
        "attributeRef": { "type": "string", "format": "uri-reference" },
        "startTime": { "$ref": "#/definitions/TM_Position" },
        "endTime": { "$ref": "#/definitions/TM_Position" },
        "linkToSensor": { "$ref": "#/definitions/SensorConnection" },
        "dynamicData": { "$ref": "#/definitions/ObservationsTimeseries" }
      },
      "required": ["attributeRef", "dynamicData"],
      "additionalProperties": false
    }
  },
  "extraAttributes": {
    "Building": {
      "dynamizer": {
        "oneOf": [
          { "$ref": "#/definitions/DynamizerAttachment" },
          {
            "type": "array",
            "items": { "$ref": "#/definitions/DynamizerAttachment" },
            "minItems": 1
          }
        ]
      }
    },
    "GenericCityObject": {
      "dynamizer": {
        "oneOf": [
          { "$ref": "#/definitions/DynamizerAttachment" },
          {
            "type": "array",
            "items": { "$ref": "#/definitions/DynamizerAttachment" },
            "minItems": 1
          }
        ]
      }
    }
  },
  "extraCityObjects": {},
  "extraSemanticSurfaces": {},
  "extraRootProperties": {}
}
